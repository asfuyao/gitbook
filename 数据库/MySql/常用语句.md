# 开启日志监控

```sql
-- 查看日志是否开启，OFF是关闭，如果是ON表示已经开启
SHOW VARIABLES LIKE "general_log%";
-- 开启日志监控
SET GLOBAL general_log = 'ON';
-- 设置日志输出到系统表
SET GLOBAL log_output = 'TABLE'; 
-- 查询日志
SELECT * FROM mysql.general_log ORDER BY event_time DESC
```



# 复制表

```sql
Create table new_table_name (Select * from old_table_name);
```

# 修改排序规则

```sql
-- 0. 按需修改以下两个变量
SET @schema_name := 'best_answer';          -- 要处理的数据库
SET @new_coll   := 'utf8mb4_zh_0900_as_cs';
SET @new_charset:= 'utf8mb4';

-- 1. 修改库默认字符集/排序规则
SELECT CONCAT('ALTER SCHEMA `',@schema_name,'` '
              'CHARACTER SET ',@new_charset,' '
              'COLLATE ',@new_coll,';') AS _sql;

-- 2. 生成所有表的 ALTER TABLE 语句
SELECT CONCAT('ALTER TABLE `',@schema_name,'`.`',table_name,'` '
              'CHARACTER SET ',@new_charset,' '
              'COLLATE ',@new_coll,';') AS _sql
FROM information_schema.tables
WHERE table_schema = @schema_name
  AND table_type   = 'BASE TABLE';

-- 3. 生成所有字符列的 ALTER TABLE … MODIFY 语句
SELECT CONCAT(
    'ALTER TABLE `',@schema_name,'`.`',table_name,'` ',
    GROUP_CONCAT(
        CONCAT('MODIFY `',column_name,'` ',column_type,
               ' CHARACTER SET ',@new_charset,
               ' COLLATE ',@new_coll,
               IF(is_nullable='NO',' NOT NULL',''),
               IF(column_default IS NOT NULL,
                  CONCAT(' DEFAULT ',QUOTE(column_default)),''),
               ' COMMENT ',QUOTE(column_comment))
        ORDER BY ordinal_position
        SEPARATOR ', '),';') AS _sql
FROM information_schema.columns
WHERE table_schema = @schema_name
  AND table_type   = 'BASE TABLE'
  AND data_type IN ('char','varchar','text','tinytext','mediumtext','longtext','enum','set')
GROUP BY table_name;

-- 4. 把上面三步查出的结果复制出来，检查无误后执行即可
```

